# KPI: Fournisseurs - Archivés
# Fournisseurs archivés (archived_at NOT NULL)

id: kpi-org-suppliers-archived
name: Fournisseurs - Archivés
description: |
  Nombre de fournisseurs archivés (archived_at NOT NULL).
  Fournisseurs avec lesquels collaboration terminée définitivement.

module: Organisations
category: Compteurs
subcategory: Fournisseurs - Stats Header
owner: Romeo Dos Santos

formula: |
  suppliers_archived = COUNT(organisations
    WHERE type = 'supplier'
    AND archived_at IS NOT NULL)

  Filtrage : archivedSuppliers.length

inputs:
  - name: archivedSuppliers
    type: array
    description: Liste fournisseurs archivés (query séparée)
    source: useOrganisations hook avec archived=true

output:
  type: number
  unit: count
  format: integer
  description: Nombre fournisseurs archivés

source:
  table: organisations
  hook: useOrganisations
  file: src/app/contacts-organisations/suppliers/page.tsx
  query: |
    SELECT COUNT(*) as archived
    FROM organisations
    WHERE type = 'supplier'
    AND archived_at IS NOT NULL
  calculation_line: 249

displayed_in:
  - component: src/app/contacts-organisations/suppliers/page.tsx
    location: "Stats header - Badge 'Archivés' (ligne ~314-329)"
    description: 'Troisième badge row statistiques avec couleur grise'
    screenshot: suppliers-list-page.png

thresholds:
  excellent: '< 10%'
  good: '10-20%'
  warning: '20-40%'
  critical: '> 40%'
  interpretation: |
    Pourcentage archivés / total fournisseurs :
    - < 10% : Excellent (peu de ruptures)
    - 10-20% : Normal (turnover acceptable)
    - 20-40% : Attention (instabilité réseau)
    - > 40% : Critique (trop de ruptures)

tests:
  - scenario: 'Production actuelle'
    inputs:
      archived_count: 0
      total: 11
    expected_output: 0
    rate: '0%'
    threshold_expected: 'excellent'

  - scenario: 'Turnover élevé'
    inputs:
      archived_count: 25
      total: 50
    expected_output: 25
    rate: '50%'
    threshold_expected: 'critical'

metadata:
  created_at: 2025-10-22
  last_updated: 2025-10-22
  validated_by: Romeo Dos Santos
  version: 2.0.0
  status: active
  priority: medium

business_notes: |
  **Contexte Vérone** :
  - archived_at NOT NULL → fournisseur archivé définitivement
  - Soft delete pattern (données conservées)
  - KPI santé réseau fournisseurs (taux turnover)

  **Valeur production** : 0 archivés / 11 total (0% - 2025-10-22)
  → Excellent : aucune rupture fournisseur à date

  **Onglet dédié** : Affichage liste archivés dans onglet séparé

references:
  - docs/database/SCHEMA-REFERENCE.md (organisations.archived_at)
  - docs/database/best-practices.md (soft delete pattern)
  - Screenshot: tools/reports/2025-10-22/suppliers-list-page.png
