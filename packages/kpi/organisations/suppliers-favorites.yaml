# KPI: Fournisseurs - Favoris
# Fournisseurs marqués comme favoris (preferred_supplier=true)

id: kpi-org-suppliers-favorites
name: Fournisseurs - Favoris
description: |
  Nombre de fournisseurs marqués comme favoris/préférés (preferred_supplier=true).
  Indique fournisseurs stratégiques prioritaires pour commandes.

module: Organisations
category: Compteurs
subcategory: Fournisseurs - Stats Header
owner: Romeo Dos Santos

formula: |
  suppliers_favorites = COUNT(suppliers WHERE preferred_supplier = true)

  Filtrage : suppliers.filter(s => s.preferred_supplier === true).length

inputs:
  - name: suppliers
    type: array
    description: Liste fournisseurs depuis organisations type='supplier'
    source: useOrganisations hook

output:
  type: number
  unit: count
  format: integer
  description: Nombre fournisseurs favoris

source:
  table: organisations
  hook: useOrganisations
  file: src/app/contacts-organisations/suppliers/page.tsx
  query: |
    SELECT COUNT(*) as favorites
    FROM organisations
    WHERE type = 'supplier'
    AND preferred_supplier = true
    AND archived_at IS NULL
  calculation_line: 250

displayed_in:
  - component: src/app/contacts-organisations/suppliers/page.tsx
    location: "Stats header - Badge 'Favoris' (ligne ~331-346)"
    description: "Quatrième badge row statistiques avec icône étoile"
    screenshot: suppliers-list-page.png

thresholds:
  excellent: "3-8 favoris"
  good: "1-3 favoris"
  warning: "> 8 favoris OU 0 favoris"
  critical: "0 favoris avec > 20 suppliers"
  interpretation: |
    - 3-8 favoris : Optimal (diversification + priorisation)
    - 1-3 favoris : Acceptable (focus limité)
    - > 8 favoris : Trop de favoris (perd sens priorisation)
    - 0 favoris : Aucun fournisseur stratégique identifié

tests:
  - scenario: "Production actuelle"
    inputs:
      favorites_count: 1
      total: 11
    expected_output: 1
    rate: "9%"
    threshold_expected: "good"

  - scenario: "Optimal"
    inputs:
      favorites_count: 5
      total: 30
    expected_output: 5
    rate: "17%"
    threshold_expected: "excellent"

metadata:
  created_at: 2025-10-22
  last_updated: 2025-10-22
  validated_by: Romeo Dos Santos
  version: 2.0.0
  status: active
  priority: medium

business_notes: |
  **Contexte Vérone** :
  - preferred_supplier=true → fournisseur stratégique prioritaire
  - Utilisé pour tri et filtrage rapide
  - **Valeur production** : 1 favori / 11 total (9% - 2025-10-22)

  **Best practice** :
  - 10-30% fournisseurs en favoris = Optimal
  - Éviter trop de favoris (perd sens)
  - **Onglet dédié** : Affichage filtre favoris dans onglet séparé

references:
  - docs/database/SCHEMA-REFERENCE.md (organisations.preferred_supplier)
  - Screenshot: tools/reports/2025-10-22/suppliers-list-page.png
