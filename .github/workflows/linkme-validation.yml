# ğŸ”— LINKME VALIDATION WORKFLOW
#
# Workflow dÃ©diÃ© pour l'app LinkMe (commissions)
# SÃ©parÃ© du Back-Office pour Ã©viter les dÃ©ploiements croisÃ©s

name: ğŸ”— LinkMe Validation

on:
  pull_request:
    branches: [main]
    paths:
      # LinkMe app uniquement
      - 'apps/linkme/**'
      # Shared packages (peuvent affecter LinkMe)
      - 'packages/**'
      # Root config files
      - 'package.json'
      - 'pnpm-lock.yaml'
      - 'turbo.json'
      - 'tsconfig.json'
  push:
    branches: [main]
    paths:
      - 'apps/linkme/**'
      - 'packages/**'
      - 'package.json'
      - 'pnpm-lock.yaml'
      - 'turbo.json'
      - 'tsconfig.json'

permissions:
  contents: read

env:
  NODE_VERSION: '20'

jobs:
  linkme-build:
    name: ğŸ”— LinkMe Build & Validate
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 10.13.1

      - name: âš¡ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'pnpm'

      - name: ğŸ“¦ Install dependencies
        run: pnpm install

      - name: ğŸ”§ TypeScript check (LinkMe)
        run: pnpm turbo run type-check --filter=@verone/linkme
        env:
          NODE_OPTIONS: --max-old-space-size=4096

      - name: ğŸ—ï¸ Build LinkMe
        run: pnpm turbo run build --filter=@verone/linkme
        env:
          NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}
          NEXT_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY }}

      - name: âœ… LinkMe Validation Complete
        run: |
          echo "âœ… LinkMe build successful"
          echo "ğŸ“¦ App: @verone/linkme"
          echo "ğŸŒ Vercel: linkme.vercel.app"

# Note: Le dÃ©ploiement Vercel est gÃ©rÃ© par Vercel Git Integration
# Ce workflow valide uniquement la build avant merge
