{
  "metadata": {
    "generated_at": "2025-10-28T17:00:00Z",
    "total_errors": 92,
    "baseline_errors": 313,
    "improvement_pct": 70.6,
    "analyzer": "verone-typescript-fixer + Claude Code",
    "clustering_method": "structural_root_cause"
  },
  "structural_categories": [
    {
      "id": "cat_01",
      "name": "Deleted Module Imports",
      "root_cause": "Error-detection system (@/lib/error-detection/*) was deleted but 20+ imports remain active",
      "error_codes": ["TS2307"],
      "error_count": 20,
      "priority": "P1",
      "blocking": false,
      "impact": "quick_win",
      "difficulty": "easy",
      "estimated_time_min": 15,
      "risk_level": "low",
      "solution_strategy": "Comment out all imports to @/lib/error-detection/* with explanatory comments",
      "files_affected": [
        "src/hooks/use-error-reporting.ts",
        "src/hooks/use-error-reporting-integration.ts",
        "src/hooks/use-manual-tests.ts",
        "src/components/business/error-reporting-dashboard.tsx",
        "src/components/business/dashboard-error-integration.tsx",
        "src/components/testing/error-analytics-dashboard.tsx",
        "src/components/testing/error-detection-panel.tsx",
        "src/lib/ai/business-predictions.ts",
        "src/lib/ai/error-pattern-learner.ts",
        "src/lib/ai/sequential-thinking-processor.ts",
        "src/lib/excel-utils.ts"
      ],
      "dependencies": [],
      "blocks": [],
      "unlocks": [],
      "batch_assignment": "BATCH 61"
    },
    {
      "id": "cat_02",
      "name": "Database Type Misalignment",
      "root_cause": "Canonical interfaces in hooks (use-contacts, use-products) not aligned with database.ts Supabase-generated types. Optional (?) vs Nullable (| null) mismatch.",
      "error_codes": ["TS2322"],
      "error_count": 10,
      "priority": "P0",
      "blocking": true,
      "impact": "high",
      "difficulty": "medium",
      "estimated_time_min": 60,
      "risk_level": "medium",
      "solution_strategy": "1. Create src/types/canonical/ with types aligned to database.ts. 2. Replace all local definitions with imports. 3. Fix optional vs nullable (?: vs | null).",
      "files_affected": [
        "src/hooks/use-contacts.ts",
        "src/hooks/use-consultation-images.ts",
        "src/hooks/use-products.ts",
        "src/hooks/use-collections.ts",
        "src/components/business/contacts-management-section.tsx",
        "src/components/business/contact-form-modal.tsx",
        "src/components/business/unified-organisation-form.tsx",
        "src/components/business/product-image-gallery.tsx"
      ],
      "dependencies": [],
      "blocks": [
        "cat_03_null_undefined",
        "cat_04_missing_properties",
        "cat_14_property_not_exist"
      ],
      "unlocks": ["cat_03", "cat_04", "cat_06", "cat_14"],
      "batch_assignment": "BATCH 62"
    },
    {
      "id": "cat_03",
      "name": "Null vs Undefined Mismatch",
      "root_cause": "Components use ?? undefined but interfaces expect | null. Inconsistent nullability conventions across codebase.",
      "error_codes": ["TS2322"],
      "error_count": 8,
      "priority": "P2",
      "blocking": false,
      "impact": "medium",
      "difficulty": "easy",
      "estimated_time_min": 30,
      "risk_level": "low",
      "solution_strategy": "Replace ?? undefined with ?? null in all components where interface expects nullable. Follow database.ts convention (nullable, not optional).",
      "files_affected": [
        "src/app/canaux-vente/prix-clients/page.tsx",
        "src/app/consultations/page.tsx",
        "src/components/business/consultations.ts",
        "src/components/business/collection-products-modal.tsx",
        "src/components/business/product-image-gallery.tsx"
      ],
      "dependencies": ["cat_02"],
      "blocks": [],
      "unlocks": [],
      "batch_assignment": "BATCH 63"
    },
    {
      "id": "cat_04",
      "name": "Duplicate Type Definitions",
      "root_cause": "Contact, ProductImage, ConsultationImage have 2-8 definitions across codebase, creating import conflicts and type incompatibilities.",
      "error_codes": ["TS2322"],
      "error_count": 5,
      "priority": "P0",
      "blocking": true,
      "impact": "high",
      "difficulty": "medium",
      "estimated_time_min": 30,
      "risk_level": "medium",
      "solution_strategy": "Part of BATCH 62 Type Unification. Remove local definitions, keep only canonical types in src/types/canonical/.",
      "duplicate_types": {
        "Contact": {
          "definitions_count": 3,
          "locations": [
            "src/hooks/use-contacts.ts (canonical)",
            "src/components/business/contact-form-modal.tsx (local)",
            "src/components/business/organisation-contacts-manager.tsx (inline)"
          ]
        },
        "ProductImage": {
          "definitions_count": 8,
          "locations": [
            "src/hooks/use-product-images.ts (canonical)",
            "src/hooks/use-collection-images.ts",
            "src/components/business/product-image-gallery.tsx",
            "src/components/business/collection-products-modal.tsx",
            "src/components/business/product-image-viewer-modal.tsx",
            "src/app/produits/catalogue/collections/page.tsx",
            "src/stories/product-card.stories.tsx",
            "src/types/catalogue.ts"
          ]
        },
        "ConsultationImage": {
          "definitions_count": 2,
          "locations": [
            "src/hooks/use-consultation-images.ts (canonical)",
            "src/components/business/consultation-image-gallery.tsx (local)"
          ]
        }
      },
      "dependencies": ["cat_02"],
      "blocks": ["cat_03", "cat_06"],
      "unlocks": ["cat_03", "cat_06", "cat_13"],
      "batch_assignment": "BATCH 62"
    },
    {
      "id": "cat_05",
      "name": "Supabase Generic Overloads",
      "root_cause": "use-base-hook.ts uses over-constrained generics that are incompatible with Supabase generated types. Generic T extends Database['public']['Tables'][TableName]['Row'] but insert/update operations need Insert<T>/Update<T> types.",
      "error_codes": ["TS2769"],
      "error_count": 19,
      "priority": "P2",
      "blocking": false,
      "impact": "medium",
      "difficulty": "hard",
      "estimated_time_min": 90,
      "risk_level": "high",
      "solution_strategy": "Simplify use-base-hook.ts by removing generic constraints or creating specific hooks instead of ultra-generic one. Alternative: Use .from(tableName as any) with type assertions.",
      "files_affected": [
        "src/hooks/use-base-hook.ts (source, 6 errors)",
        "src/hooks/use-error-reporting.ts",
        "src/hooks/use-catalogue.ts",
        "All hooks using createGenericHook<T>()"
      ],
      "dependencies": [],
      "blocks": [],
      "unlocks": [],
      "batch_assignment": "BATCH 67",
      "warning": "HIGH RISK - Complex refactoring required. Do last after all other batches."
    },
    {
      "id": "cat_06",
      "name": "Missing Interface Properties",
      "root_cause": "Components create objects with properties not defined in target interface, or missing required properties.",
      "error_codes": ["TS2740", "TS2741"],
      "error_count": 6,
      "priority": "P2",
      "blocking": false,
      "impact": "medium",
      "difficulty": "easy",
      "estimated_time_min": 20,
      "risk_level": "low",
      "solution_strategy": "Add missing properties to interfaces or make them optional. Verify against database schema before adding.",
      "files_affected": [
        "src/app/produits/catalogue/categories/[categoryId]/page.tsx",
        "src/components/business/sales-order-form-modal.tsx",
        "src/hooks/use-error-reporting-integration.ts"
      ],
      "dependencies": ["cat_02"],
      "blocks": [],
      "unlocks": [],
      "batch_assignment": "BATCH 64"
    },
    {
      "id": "cat_07",
      "name": "Enum Type Conversions",
      "root_cause": "String literals assigned to enum-typed properties without type assertions. customer_type: 'B2B' vs customer_type: CustomerType enum.",
      "error_codes": ["TS2322", "TS2678"],
      "error_count": 3,
      "priority": "P3",
      "blocking": false,
      "impact": "low",
      "difficulty": "easy",
      "estimated_time_min": 15,
      "risk_level": "low",
      "solution_strategy": "Add 'as CustomerType' type assertions or change enum to string literal union type.",
      "files_affected": [
        "src/app/canaux-vente/prix-clients/page.tsx",
        "src/components/business/error-reporting-dashboard.tsx"
      ],
      "dependencies": [],
      "blocks": [],
      "unlocks": [],
      "batch_assignment": "BATCH 65"
    },
    {
      "id": "cat_08",
      "name": "UI Component Props Mismatch",
      "root_cause": "Props passed to shadcn/ui components that don't exist in component interface. className, required, ref props on Dialog, Button, CategorySelector.",
      "error_codes": ["TS2322"],
      "error_count": 4,
      "priority": "P3",
      "blocking": false,
      "impact": "low",
      "difficulty": "easy",
      "estimated_time_min": 15,
      "risk_level": "low",
      "solution_strategy": "Remove invalid props or wrap components with div to apply props. Verify shadcn/ui component API.",
      "files_affected": [
        "src/components/business/command-palette-search.tsx",
        "src/components/business/quick-action-modal.tsx",
        "src/components/business/wizard-sections/general-info-section.tsx",
        "src/components/ui/calendar.tsx"
      ],
      "dependencies": [],
      "blocks": [],
      "unlocks": [],
      "batch_assignment": "BATCH 65"
    },
    {
      "id": "cat_09",
      "name": "Storybook Template Imports",
      "root_cause": "Storybook template files (_templates/*.tsx) import types from non-existent @/components/path/to/component-name. Templates meant as examples, not actual stories.",
      "error_codes": ["TS2307"],
      "error_count": 6,
      "priority": "P3",
      "blocking": false,
      "impact": "none",
      "difficulty": "trivial",
      "estimated_time_min": 10,
      "risk_level": "none",
      "solution_strategy": "Comment out imports in template files or move templates to docs/examples/ outside type-checked src/.",
      "files_affected": [
        "src/stories/_templates/basic-story.template.tsx",
        "src/stories/_templates/business-story.template.tsx",
        "src/stories/_templates/form-story.template.tsx"
      ],
      "dependencies": [],
      "blocks": [],
      "unlocks": [],
      "batch_assignment": "BATCH 66"
    },
    {
      "id": "cat_10",
      "name": "Implicit Any Index Access",
      "root_cause": "Object indexed with string but no index signature defined. metrics[module_name] where metrics: { catalogue: number; ... } with no [key: string]: number.",
      "error_codes": ["TS7053"],
      "error_count": 3,
      "priority": "P3",
      "blocking": false,
      "impact": "low",
      "difficulty": "easy",
      "estimated_time_min": 10,
      "risk_level": "low",
      "solution_strategy": "Add index signature [key: string]: number to interface or use type assertion metrics[module_name as keyof typeof metrics].",
      "files_affected": ["src/hooks/use-error-reporting-integration.ts"],
      "dependencies": [],
      "blocks": [],
      "unlocks": [],
      "batch_assignment": "BATCH 68"
    },
    {
      "id": "cat_11",
      "name": "Spread Type Issues",
      "root_cause": "Spread operator {...object} used on non-object type or adds properties not in target interface.",
      "error_codes": ["TS2698"],
      "error_count": 1,
      "priority": "P3",
      "blocking": false,
      "impact": "low",
      "difficulty": "easy",
      "estimated_time_min": 5,
      "risk_level": "low",
      "solution_strategy": "Use explicit object construction instead of spread operator (pattern validated in BATCH 60).",
      "files_affected": ["src/hooks/use-archived-products.ts"],
      "dependencies": [],
      "blocks": [],
      "unlocks": [],
      "batch_assignment": "BATCH 68"
    },
    {
      "id": "cat_12",
      "name": "Type Instantiation Excessive Depth",
      "root_cause": "Deeply nested generic types cause TypeScript to hit instantiation depth limit. Likely in use-error-reporting.ts with complex Supabase types.",
      "error_codes": ["TS2589"],
      "error_count": 1,
      "priority": "P3",
      "blocking": false,
      "impact": "low",
      "difficulty": "medium",
      "estimated_time_min": 20,
      "risk_level": "medium",
      "solution_strategy": "Simplify nested generics by creating intermediate type aliases. Break down complex type into smaller pieces.",
      "files_affected": ["src/hooks/use-error-reporting.ts"],
      "dependencies": [],
      "blocks": [],
      "unlocks": [],
      "batch_assignment": "BATCH 68"
    },
    {
      "id": "cat_13",
      "name": "Form Library Resolver Types",
      "root_cause": "React Hook Form Resolver type mismatch. Schema defines optional boolean (is_primary_contact?: boolean) but resolver expects required boolean.",
      "error_codes": ["TS2322"],
      "error_count": 3,
      "priority": "P2",
      "blocking": false,
      "impact": "medium",
      "difficulty": "medium",
      "estimated_time_min": 20,
      "risk_level": "medium",
      "solution_strategy": "Align Zod schema default values with form resolver expectations. Make booleans required in schema if resolver expects them required.",
      "files_affected": [
        "src/components/business/contact-form-modal.tsx",
        "src/components/business/unified-organisation-form.tsx"
      ],
      "dependencies": ["cat_04"],
      "blocks": [],
      "unlocks": [],
      "batch_assignment": "BATCH 68"
    },
    {
      "id": "cat_14",
      "name": "Property Does Not Exist",
      "root_cause": "Accessing properties that don't exist on type. QueueMetrics.success_rate, dashboard_error_integration accessing removed error-detection properties.",
      "error_codes": ["TS2339", "TS2304", "TS2352", "TS18046"],
      "error_count": 8,
      "priority": "P2",
      "blocking": false,
      "impact": "medium",
      "difficulty": "easy",
      "estimated_time_min": 15,
      "risk_level": "low",
      "solution_strategy": "Remove accesses to non-existent properties. Update interfaces if properties should exist. Related to deleted error-detection system.",
      "files_affected": [
        "src/components/business/dashboard-error-integration.tsx (5 errors)",
        "src/components/business/error-reporting-dashboard.tsx",
        "src/app/produits/sourcing/produits/[id]/page.tsx",
        "src/hooks/use-consultations.ts"
      ],
      "dependencies": ["cat_02"],
      "blocks": [],
      "unlocks": [],
      "batch_assignment": "BATCH 68"
    }
  ],
  "dependency_graph": {
    "nodes": [
      { "id": "cat_01", "label": "Module Cleanup", "independent": true },
      { "id": "cat_02", "label": "Type Unification", "critical": true },
      { "id": "cat_03", "label": "Null/Undefined" },
      { "id": "cat_04", "label": "Duplicates" },
      {
        "id": "cat_05",
        "label": "Supabase Overloads",
        "independent": true,
        "high_risk": true
      },
      { "id": "cat_06", "label": "Missing Props" },
      { "id": "cat_07", "label": "Enums" },
      { "id": "cat_08", "label": "UI Props" },
      { "id": "cat_09", "label": "Storybook", "independent": true },
      { "id": "cat_10", "label": "Index Access" },
      { "id": "cat_11", "label": "Spread" },
      { "id": "cat_12", "label": "Type Depth" },
      { "id": "cat_13", "label": "Resolvers" },
      { "id": "cat_14", "label": "Property Exists" }
    ],
    "edges": [
      { "from": "cat_02", "to": "cat_03", "type": "unlocks" },
      { "from": "cat_02", "to": "cat_04", "type": "unlocks" },
      { "from": "cat_02", "to": "cat_06", "type": "unlocks" },
      { "from": "cat_02", "to": "cat_14", "type": "unlocks" },
      { "from": "cat_04", "to": "cat_13", "type": "unlocks" }
    ]
  },
  "batch_summary": {
    "total_batches": 8,
    "total_estimated_time_min": 345,
    "total_estimated_hours": 5.75,
    "quick_wins": ["cat_01", "cat_09"],
    "critical_path": ["cat_02", "cat_03", "cat_04", "cat_06"],
    "high_risk": ["cat_05"],
    "batches": [
      {
        "batch_id": "BATCH_61",
        "name": "Module Cleanup",
        "categories": ["cat_01"],
        "estimated_time_min": 15,
        "risk": "low",
        "error_reduction": 20,
        "cumulative_remaining": 72
      },
      {
        "batch_id": "BATCH_62",
        "name": "Type Unification",
        "categories": ["cat_02", "cat_04"],
        "estimated_time_min": 60,
        "risk": "medium",
        "error_reduction": 8,
        "cumulative_remaining": 64,
        "critical": true,
        "unlocks": ["BATCH_63", "BATCH_64", "BATCH_68"]
      },
      {
        "batch_id": "BATCH_63",
        "name": "Null/Undefined Alignment",
        "categories": ["cat_03"],
        "estimated_time_min": 30,
        "risk": "low",
        "error_reduction": 8,
        "cumulative_remaining": 56,
        "requires": ["BATCH_62"]
      },
      {
        "batch_id": "BATCH_64",
        "name": "Missing Properties",
        "categories": ["cat_06"],
        "estimated_time_min": 20,
        "risk": "low",
        "error_reduction": 6,
        "cumulative_remaining": 50,
        "requires": ["BATCH_62"]
      },
      {
        "batch_id": "BATCH_65",
        "name": "Enum & UI Props",
        "categories": ["cat_07", "cat_08"],
        "estimated_time_min": 20,
        "risk": "low",
        "error_reduction": 9,
        "cumulative_remaining": 41
      },
      {
        "batch_id": "BATCH_66",
        "name": "Storybook Cleanup",
        "categories": ["cat_09"],
        "estimated_time_min": 10,
        "risk": "none",
        "error_reduction": 6,
        "cumulative_remaining": 35
      },
      {
        "batch_id": "BATCH_68",
        "name": "Final Cleanup",
        "categories": ["cat_10", "cat_11", "cat_12", "cat_13", "cat_14"],
        "estimated_time_min": 60,
        "risk": "medium",
        "error_reduction": 16,
        "cumulative_remaining": 19,
        "requires": ["BATCH_62"]
      },
      {
        "batch_id": "BATCH_67",
        "name": "Supabase Overloads",
        "categories": ["cat_05"],
        "estimated_time_min": 90,
        "risk": "high",
        "error_reduction": 19,
        "cumulative_remaining": 0,
        "warning": "Do last - highest risk"
      }
    ]
  },
  "recommendations": {
    "optimal_order": [
      "BATCH_61",
      "BATCH_62",
      "BATCH_63",
      "BATCH_64",
      "BATCH_65",
      "BATCH_66",
      "BATCH_68",
      "BATCH_67"
    ],
    "parallel_possible": [["BATCH_63", "BATCH_64", "BATCH_65"], ["BATCH_66"]],
    "validation_checkpoints": [
      { "after": "BATCH_62", "tests": ["type-check", "mcp-browser-console"] },
      { "after": "BATCH_66", "tests": ["build", "e2e-tests"] },
      { "after": "BATCH_67", "tests": ["full-validation", "performance"] }
    ]
  }
}
