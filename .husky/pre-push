#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Validation pre-push V√©rone..."
echo ""

# 1. V√©rifier si le dev server tourne
echo "üåê Checking dev server status..."
if curl -s http://localhost:3000 > /dev/null 2>&1; then
  echo "‚úÖ Dev server running"
  echo ""

  # 2. Console errors check (R√àGLE SACR√âE: Console Zero Tolerance)
  echo "üö® Checking console errors (Zero Tolerance)..."
  npm run check:console:ci || {
    echo ""
    echo "‚ùå PUSH BLOQU√â: Erreurs console d√©tect√©es"
    echo "üí° R√®gle Sacr√©e CLAUDE.md: 1 erreur console = √âCHEC COMPLET"
    echo ""
    echo "üîß Pour corriger:"
    echo "   1. V√©rifiez les erreurs affich√©es ci-dessus"
    echo "   2. Corrigez TOUTES les erreurs console"
    echo "   3. Relancez: npm run check:console"
    echo "   4. Si OK, re-tentez le push"
    echo ""
    exit 1
  }
else
  echo "‚ö†Ô∏è  Dev server NOT running (localhost:3000)"
  echo "   Console checks skipped - Will run in CI/CD"
  echo "   Pour tester manuellement: npm run check:console"
fi

echo ""
echo "‚úÖ Pre-push validation r√©ussie!"
echo ""
